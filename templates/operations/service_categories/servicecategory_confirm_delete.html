{% extends "layouts/base.html" %}
{% load static %}

{% block title %}Supprimer Catégorie - {{ category.name }}{% endblock %}

{% block content %}
<div class="pb-5">
  <div class="row align-items-center mb-4">
    <div class="col-auto">
      <h2 class="mb-0">Supprimer une Catégorie</h2>
    </div>
    <div class="col-auto ms-auto">
      <a href="{% url 'portal_admin:servicecategory_detail' category.pk %}" class="btn btn-secondary">
        <span class="fas fa-arrow-left me-2"></span>Retour
      </a>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="row justify-content-center">
    <div class="alert alert-warning">
      <h5><span class="fas fa-exclamation-triangle me-2"></span>Attention</h5>
      <p class="mb-0">Vous êtes sur le point de supprimer la catégorie <strong>{{ category.name }}</strong>.</p>
    </div>

    <div class="text-center mb-4">
      
      <div class="avatar avatar-5xl ">
        {% if category.avatar %}
          <img class="rounded-soft " src="{{ category.avatar.url }}" alt="{{ category.name }}" />
        {% else %}
          <div class="avatar-name rounded-soft">
            <span>{{ category.name|first }}</span>
          </div>
        {% endif %}
      </div>
      <h4 class="mt-3">{{ category.name }}</h4>

    </div>

    <div class="card bg-body-highlight mb-4">
      <div class="card-body">
        <h6 class="card-title">Informations sur la catégorie</h6>
        <ul class="mb-0">
          <li><strong>Nom:</strong> {{ category.name }}</li>
          <li><strong>Statut:</strong> {{ category.get_status_display }}</li>
          <li><strong>Services associés:</strong> {{ category.services.count }}</li>
          <li><strong>Date de création:</strong> {{ category.created_at|date:"d/m/Y à H:i" }}</li>
        </ul>
      </div>
    </div>

    {% if category.services.count > 0 %}
      <div class="alert alert-danger">
        <h6><span class="fas fa-exclamation-circle me-2"></span>Impossible de supprimer</h6>
        <p class="mb-2">
          <strong>Cette catégorie contient {{ category.services.count }} service(s).</strong>
        </p>
        <p class="mb-2">Vous ne pouvez pas supprimer une catégorie tant qu'elle contient des services.</p>
        <p class="mb-0"><strong>Action requise:</strong> Déplacez ou supprimez d'abord tous les services de cette catégorie.</p>

        <hr>
        <p class="mb-1"><strong>Services associés:</strong></p>
        <ul class="mb-0">
          {% for service in category.services.all %}
          <li>
            <a href="{% url 'portal_admin:service_detail' service.pk %}" class="text-dark">
              {{ service.code }} - {{ service.name }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
    {% else %}
      <div class="alert alert-info">
        <p class="mb-0">
          <span class="fas fa-info-circle me-2"></span>
          Cette catégorie ne contient aucun service. Vous pouvez la supprimer en toute sécurité.
        </p>
      </div>
    {% endif %}
    <hr>
    <form method="post" class="d-flex justify-content-end gap-2">
      {% csrf_token %}
      <a href="{% url 'portal_admin:servicecategory_detail' category.pk %}" class="btn btn-secondary">
        <span class="fas fa-times me-2"></span>Annuler
      </a>
      {% if category.services.count == 0 %}
      <button type="submit" class="btn btn-danger">
        <span class="fas fa-trash me-2"></span>Confirmer la suppression
      </button>
      {% else %}
      <button type="button" class="btn btn-danger" disabled title="Impossible de supprimer une catégorie avec des services">
        <span class="fas fa-trash me-2"></span>Suppression impossible
      </button>
      {% endif %}
    </form>
    {% if category.services.count == 0 %}
      <p class="text-danger text-center mt-3 mb-0"><small><strong>Attention:</strong> Cette action est irréversible.</small></p>
    {% endif %}
   
  </div>
</div>
{% endblock %}
